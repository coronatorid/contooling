version: "3.8"
services:
  nginx:
    image: nginx:stable
    container_name: api_nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    network_mode: host

  altair:
    image: codefluence/altair:latest
    container_name: api_altair
    volumes:
      # This folder will be autogenerated by the workflow
      - ./altair/routes/:/opt/altair/routes/
      - ./altair/config/:/opt/altair/config/
      - ./altair/migration/:/opt/altair/migration/
    env_file:
      - ./altair/.env
    ports:
      - "1304:1304"
    network_mode: host

  core:
    image: "ghcr.io/coronatorid/core-onator:${TAG}"
    container_name: api_core
    volumes:
      - /opt/storage/:/opt/storage/
    env_file:
      - ./core-onator/.env
    ports:
      - "2019:2019"
    network_mode: host
